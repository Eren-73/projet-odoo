<?xml version="1.0" encoding="UTF-8"?>
<odoo>
  <data>

    <!-- Liste des contrats -->
    <record id="view_parc_contrat_list" model="ir.ui.view">
      <field name="name">parc.contrat.list</field>
      <field name="model">parc.contrat</field>
      <field name="arch" type="xml">
        <list string="Contrats">
          <field name="name"/>
          <field name="client_id"/>
          <field name="product_id"/>
          <field name="date_debut"/>
          <field name="date_fin"/>
          <field name="next_invoice_date"/>
          <field name="statut"/>
        </list>
      </field>
    </record>

    <!-- Kanban des contrats -->
    <record id="view_parc_contrat_kanban" model="ir.ui.view">
      <field name="name">parc.contrat.kanban</field>
      <field name="model">parc.contrat</field>
      <field name="arch" type="xml">
        <kanban>
          <templates>
            <t t-name="kanban-card">
              <div class="oe_kanban_card">
                <strong><field name="name"/></strong>
                <div>Client : <field name="client_id"/></div>
                <div>Service : <field name="product_id"/></div>
                <div>Début : <field name="date_debut"/></div>
                <div>Fin : <field name="date_fin"/></div>
                <div>Prochaine échéance : <field name="next_invoice_date"/></div>
                <div>Statut : <field name="statut"/></div>
              </div>
            </t>
          </templates>
        </kanban>
      </field>
    </record>

    <!-- Formulaire du contrat -->
    <record id="view_parc_contrat_form" model="ir.ui.view">
      <field name="name">parc.contrat.form</field>
      <field name="model">parc.contrat</field>
      <field name="arch" type="xml">
        <form string="Contrat">
          <header>
            <button name="generate_invoice"
                    type="object"
                    string="Générer facture"
                    class="oe_highlight"
                    invisible="statut != 'actif'"/>
          </header>
          <sheet>
            <group>
              <field name="name"/>
              <field name="client_id"/>
              <field name="product_id"/>
            </group>
            <group>
              <field name="date_debut"/>
              <field name="date_fin"/>
            </group>
            <group>
              <field name="montant"/>
              <field name="frequence"/>
            </group>
            <group>
              <field name="next_invoice_date"/>
              <field name="statut"/>
            </group>
            <group>
              <field name="description"/>
            </group>
          </sheet>
          <notebook>
            <!-- Page équipements -->
            <page string="Équipements">
              <field name="equipment_ids" nolabel="1">
                <!-- liste in-line avec <list> (remplace <tree>) -->
                <list editable="bottom" string="Équipements du contrat">
                  <field name="name"/>
                  <field name="client_id" invisible="1"/>
                  <!-- si vous avez ajouté product_id sur parc.equipement, vous pouvez le mettre ici :
                  <field name="product_id"/> -->
                </list>
                <form string="Détail de l'équipement">
                  <sheet>
                    <group>
                      <field name="name"/>
                      <field name="client_id"/>
                      <!-- idem pour product_id -->
                    </group>
                  </sheet>
                </form>
              </field>
            </page>
            <!-- Page factures -->
            <page string="Factures">
              <field name="facture_ids" readonly="1" nolabel="1">
                <list string="Factures liées">
                  <field name="name"/>
                  <field name="invoice_date"/>
                  <field name="invoice_date_due"/>
                  <field name="amount_total"/>
                  <field name="state"/>
                </list>
                <form string="Détail de la facture">
                  <sheet>
                    <group>
                      <field name="name"/>
                      <field name="invoice_date"/>
                      <field name="invoice_date_due"/>
                      <field name="amount_total"/>
                      <field name="state"/>
                    </group>
                  </sheet>
                </form>
              </field>
            </page>
          </notebook>
        </form>
      </field>
    </record>

    <!-- Action pour afficher la liste des contrats -->
    <record id="action_parc_contrat_list" model="ir.actions.act_window">
      <field name="name">Liste des Contrats</field>
      <field name="res_model">parc.contrat</field>
      <field name="view_mode">list,form,kanban</field>
    </record>

  </data>
</odoo>
